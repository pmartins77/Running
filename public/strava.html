<script>
document.addEventListener("DOMContentLoaded", () => {
    loadActivities();
});

// ‚úÖ Fonction pour charger les activit√©s Strava
async function loadActivities() {
    const token = localStorage.getItem("jwt");

    if (!token) {
        alert("Vous devez √™tre connect√© !");
        window.location.href = "login.html";
        return;
    }

    try {
        const response = await fetch("/api/strava/list", {
            method: "GET",
            headers: { "Authorization": `Bearer ${token}` }
        });

        if (!response.ok) {
            throw new Error(`Erreur API : ${response.statusText}`);
        }

        const activities = await response.json();

        if (!Array.isArray(activities)) {
            throw new Error("Donn√©es invalides re√ßues du serveur");
        }

        displayActivities(activities);
    } catch (error) {
        console.error("‚ùå Erreur lors du chargement des activit√©s :", error);
        alert("Erreur lors du chargement des activit√©s Strava.");
    }
}

// ‚úÖ Fonction pour afficher les activit√©s dans la page
function displayActivities(activities) {
    const activitiesDiv = document.getElementById("activities");
    activitiesDiv.innerHTML = ""; // Nettoyage avant affichage

    if (activities.length === 0) {
        activitiesDiv.innerHTML = "<p>Aucune activit√© trouv√©e.</p>";
        return;
    }

    activities.forEach(activity => {
        const activityElement = document.createElement("div");
        activityElement.classList.add("activity-card");
        activityElement.innerHTML = `
            <h3>üìÖ ${new Date(activity.date).toLocaleDateString()}</h3>
            <p><strong>Type :</strong> ${activity.type}</p>
            <p><strong>Nom :</strong> ${activity.name}</p>
            <p><strong>Distance :</strong> ${activity.distance ? (activity.distance / 1000).toFixed(2) + " km" : "N/A"}</p>
            <p><strong>Dur√©e :</strong> ${activity.elapsed_time ? (activity.elapsed_time / 60).toFixed(0) + " min" : "N/A"}</p>
            <p><strong>Vitesse Moy. :</strong> ${activity.average_speed ? (activity.average_speed * 3.6).toFixed(2) + " km/h" : "N/A"}</p>
        `;
        activitiesDiv.appendChild(activityElement);
    });
}
</script>
